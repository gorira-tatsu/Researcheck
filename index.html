<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <!-- offline mode <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="styles.css">
    <script>
        const word = {
            "メリット":"デメリット",
            "デメリット":"メリット"
        }

        function getSearchbox() {
            return document.getElementById("q")
        }

        function plus(str) {
            target = getSearchbox()
            target.value = target.value + str;
            return false;
        }

        function return_opposite(target_array) {
            for (x in word) {
                target_found = target_array.indexOf(x)
                if (target_found !== -1) {
                    return word[x];
                }
                else {
                    return '';
                }
            }
        }

        function return_split(target) {
            return target.split(/[\s\u3000]+/)
        }
        
        function return_exclusion() {
            let target_value = []
            let target = document.getElementsByClassName('exclusion')
            for (let c=0;c !== target.length;c++){
                if (target[c].value !== ""){
                    target_value.push(' -' + target[c].value)
                }
            }
            return target_value.join('')
        }

        function Search(target_found, exclusion) {
            console.log(getSearchbox().value + target_found + exclusion);
            document.getElementsByClassName('gsc-input')[2].value = getSearchbox().value + target_found + exclusion;
            document.querySelector('#___gcse_0 > div > div > form > table > tbody > tr > td.gsc-search-button > button').click();
        }

        function pushSearch() {
            Search(return_opposite(return_split(getSearchbox().value)), return_exclusion())
        }

        function create_exclusion_form() {
            document.getElementById('exclusion-group').insertAdjacentHTML('beforeend','<input type="text" class="form-control search-input exclusion">')
        }

    </script>
    <title>Search</title>
</head>

<body>

<div class="container">
    <div class="row">
        <div class="col"></div>
        <div class="col-10">
            <form onsubmit="pushSearch(); return false;">
                <div class="input-group mb-3">
                    <p></p>
                    <input type="text" class="form-control search-input" aria-describedby="button-addon2" placeholder="さがしたい言葉を入れよう" id="q">
                    <button class="btn btn-primary" type="submit" id="button-addon2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>さがす</button>
                </div>
            </form>
            <p>除外する言葉 <button type="button" class="btn btn-link" onclick="create_exclusion_form()">複数除外する</button></p>
            <div class="input-group" id="exclusion-group">
                <input type="text" class="form-control search-input exclusion" id="exclusion">
            </div>
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="return plus(' or ')">または</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="return plus('site: ')">特定のサイトだけを検索</a>
                </li>
            </ul>
        </div>
        <div class="col"></div>
    </div>
    <script async src="https://cse.google.com/cse.js?cx=b0d592601bb85c52c"></script>
    <div class="gcse-search"></div>
    <p>参考: <a href="https://support.google.com/websearch/answer/2466433?hl=ja">ウェブ検索の精度を高める</a></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
</body>
</html>
